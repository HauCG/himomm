<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer List</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        .container {
            display: flex;
            gap: 20px;
        }
        .list-section {
            flex: 2;
        }
        .form-section {
            flex: 1;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: none;
        }
        .pagination {
            margin-top: 20px;
        }
        .pagination button {
            margin: 0 5px;
            padding: 5px 10px;
        }
        .pagination span {
            margin: 0 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="list-section">
        <h1>Customer List</h1>
        <button onclick="showAddForm()">Add New Customer</button>
        <table id="customerTable" border="1">
            <thead>
            <tr>
                <th>Customer ID</th>
                <th>Customer Name</th>
                <th>Province</th>
            </tr>
            </thead>
            <tbody>
            <!-- Dữ liệu sẽ được thêm vào đây -->
            </tbody>
        </table>

        <!-- Phân trang -->
        <div class="pagination">
            <button id="prevButton" onclick="loadPage(currentPage - 1)">Previous</button>
            <span id="pageInfo">Page 1</span>
            <button id="nextButton" onclick="loadPage(currentPage + 1)">Next</button>
        </div>
    </div>

    <div id="addForm" style="display: none;">
        <h2>Add New Customer</h2>
        <form onsubmit="saveCustomer(event)">
            <div>
                <label for="customerName">Customer Name:</label>
                <input type="text" id="customerName" required>
            </div>
            <div>
                <label for="province">Province:</label>
                <select id="province" required>
                    <option value="">Select Province</option>
                </select>
            </div>
            <button type="submit">Save</button>
            <button type="button" onclick="hideAddForm()">Cancel</button>
        </form>
    </div>
</div>

<script>
    let currentPage = 0;
    let totalPages = 0;

    function displayData(data) {
        const tbody = $('#customerTable tbody');
        tbody.empty();

        data.content.forEach(customer => {
            tbody.append(`
                <tr>
                    <td>${customer.customerId}</td>
                    <td>${customer.customerName}</td>
                    <td>${customer.province ? customer.province.provinceName : 'N/A'}</td>
                </tr>
            `);
        });

        currentPage = data.number;
        totalPages = data.totalPages;
        updatePaginationUI();
    }

    function updatePaginationUI() {
        $('#pageInfo').text(`Page ${currentPage + 1} / ${totalPages}`);
        $('#prevButton').prop('disabled', currentPage === 0);
        $('#nextButton').prop('disabled', currentPage >= totalPages - 1);
    }

    function loadPage(page) {
        // Kiểm tra trang hợp lệ
        if (page < 0 || (totalPages > 0 && page >= totalPages)) {
            return;
        }

        $.ajax({
            url: `http://localhost:8080/api/customers?page=${page}`,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                console.log(data);
                displayData(data);
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
            }
        });
    }

    function loadProvinces() {
        $.ajax({
            url: 'http://localhost:8080/api/provinces',
            type: 'GET',
            success: function(provinces) {
                const provinceSelect = $('#province');
                provinceSelect.empty();
                provinceSelect.append('<option value="">Select Province</option>');
                provinces.forEach(province => {
                    provinceSelect.append(`<option value="${province.provinceDtoId}">${province.provinceDtoName}</option>`);
                });
            },
            error: function(xhr, status, error) {
                console.error('Error loading provinces:', error);
            }
        });
    }

    function showAddForm() {
        $('#addForm').show();
        loadProvinces();
    }

    function hideAddForm() {
        $('#addForm').hide();
        $('#customerName').val('');
        $('#province').val('');
    }

    function saveCustomer(event) {
        event.preventDefault();

        const customerData = {
            customerName: $('#customerName').val(),
            province: {
                provinceId: $('#province').val()
            }
        };

        $.ajax({
            url: 'http://localhost:8080/api/restCreateCustomers',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(customerData),
            success: function(response) {
                alert('Customer saved successfully!');
                hideAddForm();
                loadPage(currentPage);
            },
            error: function(xhr, status, error) {
                console.error('Error saving customer:', error);
                alert('Error saving customer. Please try again.');
            }
        });
    }

    loadPage(currentPage);
</script>
</body>
</html>